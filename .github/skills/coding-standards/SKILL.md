---
name: coding-standards
description: 为 TypeScript/JavaScript（React/Vue/Node）项目建立可自动校验的 Hard Gate 编码规范：ESLint/TypeScript/Prettier + 边界约束（跨层/exports-only/禁止深层 import）+ 依赖检查（unused/ghost/版本漂移），并将架构/工程化规则尽可能落到可执行门禁（支持按仓库形态与主要改动层级自适应）。
compatibility: Multi-assistant (Claude/Windsurf/Cursor/GitHub Skills)
metadata: Generated from canonical skillspec.json
---
# coding-standards

## Overview
为 TypeScript/JavaScript（React/Vue/Node）项目建立可自动校验的 Hard Gate 编码规范：ESLint/TypeScript/Prettier + 边界约束（跨层/exports-only/禁止深层 import）+ 依赖检查（unused/ghost/版本漂移），并将架构/工程化规则尽可能落到可执行门禁（支持按仓库形态与主要改动层级自适应）。

## Triggers
- 我想给仓库增加 Hard Gate 编码规范（lint/typecheck/test/depcheck + 边界）
- 帮我设置禁止跨层依赖、仅允许从 exports 导入、禁止深层 import
- 帮我把架构/工程化规范变成可自动校验的门禁
- 为 pnpm monorepo 配置 ESLint/TypeScript/Prettier + 边界检查
- 为 PR/CI 增加强制的质量门禁
- 整理代码

## Workflow
*Mode:* `sequential`

### Step 1 — 识别仓库形态（repo shape）并选择最小改动路径
*Type:* `action`
必须识别 pnpm-workspace / pnpm+nx / pnpm+turbo / pnpm-single，并给出证据；默认选择‘兼容现状 + 最小改动’路径。规则模板见 `.windsurf/workflows/data/coding-standards/repo-shapes/*.json`，详细规则见 `references/hard-gate.md`。
### Step 2 — 基于 git diff 识别主要改动层级（type-first）
*Type:* `action`
统计变更文件命中各 layer 的次数，输出 primary_layer 与 layers_changed；跨层变更时，额外强调边界与抽象复核。层级模型模板见 `.windsurf/workflows/data/coding-standards/layers/type-first.json`，详细规则见 `references/hard-gate.md`。
### Step 3 — Hard Gate 基线：ESLint + TypeScript + Prettier（早期接入）
*Type:* `gate`
目标：ESLint 覆盖 TS/JS 并按框架启用规则；TypeScript 使用 `tsc -b`；Prettier 只负责格式，避免与 ESLint 冲突。命令契约建议见 `references/pnpm-snippets.md`。
### Step 4 — 边界约束（Hard Gate）：跨层/exports-only/禁止深层 import
*Type:* `gate`
必须覆盖：禁止跨层依赖；只允许从 package.json#exports 导入；禁止深层内部目录 import。工具落地二选一：eslint-plugin-boundaries 或 dependency-cruiser（随 repo shape 推荐）。细节与默认 denylist 见 `references/hard-gate.md`。
### Step 5 — 可移植性（Hard Gate）：绝对路径/cwd 依赖/alias 一致性/环境敏感值
*Type:* `gate`
必须覆盖：绝对路径/用户目录、cwd 不确定性、alias 一致性、环境敏感值治理。细节见 `references/hard-gate.md` 的“可移植性（Hard Gate）”章节。
### Step 6 — 循环依赖（Hard Gate）：模块循环 / 包循环 / 项目引用循环
*Type:* `gate`
必须覆盖：模块循环/包循环/TS 引用循环的检测与阻断。细节见 `references/hard-gate.md` 的“循环依赖（Hard Gate）”章节。
### Step 7 — 安全与仓库卫生（Hard Gate）：secrets / 危险 API / 产物入库 / lock 策略
*Type:* `gate`
必须覆盖：secrets、危险 API、产物入库、lock 策略一致性。细节见 `references/hard-gate.md` 的“安全与仓库卫生（Hard Gate）”章节。
### Step 8 — 架构/工程化规范（尽可能自动化，剩余项进入 review gate）
*Type:* `action`
默认按 type-first；层内职责边界采用‘目录即职责 + 依赖反推职责’；命名与一致性按约定；复杂度门槛：单函数 60 行、圈复杂度 15、鼓励早返回减少嵌套（保留必要 try-catch）；错误/日志/注释/文档按约定。详见 `references/hard-gate.md`。
### Step 9 — 依赖检查（Hard Gate）：unused / ghost / 版本漂移
*Type:* `gate`
必须覆盖：未使用依赖；幽灵依赖/越界依赖；版本漂移。推荐组合：depcheck/knip + import/no-extraneous-dependencies + syncpack。落地建议见 `references/pnpm-snippets.md`。
### Step 10 — CI PR gate 绑定 + 汇总输出（可执行清单）
*Type:* `action`
触发：手动运行 + 绑定到 CI PR 检查。输出必须包含：repo_shape、primary_layer、边界工具选择；Hard Gate 自动化项/仅 review 项；最小 diff 的配置文件清单；本地与 CI 可复制命令清单。输出模板见 `references/hard-gate.md`。

## References (loaded on-demand)
- `references/hard-gate.md`
- `references/pnpm-snippets.md`

## Assets
- `assets/windsurf-workflow-data`

## Output contract
- Deterministic artifacts (files, zips, reports) whenever possible
- Machine-readable output available when scripts support `--json`

---
Generated by ai-skill-creator at 2026-01-21T07:39:29Z.
