{
  "version": 1,
  "name": "review-gate",
  "description": "为 TypeScript/JavaScript（React/Vue/Node）项目建立架构与工程化 Review 规范：明确分层职责边界、模块 API 设计、副作用隔离、复杂度与可读性、错误处理策略等，提供可执行的 PR Review Checklist，防止架构在长期演进中"慢慢写歪"。",
    "questions": [
    "你的仓库采用什么分层模型（type-first / feature-first / 其他），现有层级命名是什么？",
    "是否已有明确的架构/工程规范文档，或仅依靠口头约定？",
    "PR Review 流程是什么（必须至少 1 人 approve / 需要架构师 review / 其他）？",
    "哪些架构检查点是团队反复强调但容易被忽略的（跨层依赖/副作用隔离/命名一致性/其他）？",
    "是否需要生成 PR Review Checklist 模板，以及是否要集成到 PR 模板中？",
    "团队是否有特定的代码风格偏好（例如：early return / 禁止 default export / 统一错误类型）？"
  ],
  "triggers": [
    "我想建立 PR Review 架构规范检查点",
    "帮我生成 PR Review Checklist 模板",
    "如何在 Review 中检查分层职责边界",
    "如何防止架构在演进中写歪",
    "设置工程化规范和代码审查标准",
    "软评审代码"
  ],
  "freedom_level": "medium",
  "workflow": {
    "type": "sequential",
    "steps": [
      {
        "id": "understand",
        "title": "理解现有架构与分层模型",
        "kind": "action",
        "commands": [],
        "notes": "识别仓库的分层模型（type-first / feature-first / 其他），梳理现有层级命名（presentation/application/domain/infra/shared/types/tests 或其他）。输出当前架构概览。"
      },
      {
        "id": "review-points",
        "title": "识别关键 Review 检查点（基于团队痛点）",
        "kind": "action",
        "commands": [],
        "notes": "基于团队反馈和常见问题，识别最重要的 Review 检查点。参考 `references/review-gate.md` 中的完整检查点清单，优先级排序。"
      },
      {
        "id": "checklist",
        "title": "生成 PR Review Checklist 模板",
        "kind": "action",
        "commands": [],
        "notes": "基于识别的检查点，生成具体的、可执行的 PR Review Checklist。包括架构层面、设计层面、代码质量、文档与可维护性、性能与安全等维度。模板见 `references/review-gate.md`。"
      },
      {
        "id": "layer-boundary",
        "title": "审查分层边界与依赖方向",
        "kind": "action",
        "commands": [],
        "notes": "检查当前 PR 的变更是否符合分层模型，是否存在跨层耦合或违反依赖方向的情况。重点关注 domain/application 是否回依赖了 infra/presentation。详见 `references/review-gate.md`。"
      },
      {
        "id": "api-design",
        "title": "审查模块 API 设计与边界",
        "kind": "action",
        "commands": [],
        "notes": "检查新增或修改的 public API 是否设计合理：是否通过 exports 暴露、是否有清晰边界、是否滥用 default export、是否在深层目录新增 index.ts 导致循环依赖风险。详见 `references/review-gate.md`。"
      },
      {
        "id": "side-effects",
        "title": "审查副作用隔离与可测试性",
        "kind": "action",
        "commands": [],
        "notes": "检查 domain/application 层是否保持纯净（不直接依赖 network/fs/db/time/random），I/O 操作是否集中在 infra/adapter 并通过抽象注入。详见 `references/review-gate.md`。"
      },
      {
        "id": "complexity-readability",
        "title": "审查复杂度与可读性",
        "kind": "action",
        "commands": [],
        "notes": "除了 Hard Gate 限制的指标（单函数 60 行、圈复杂度 15），还需关注认知复杂度、嵌套层级、函数职责、抽象层次一致性。详见 `references/review-gate.md`。"
      },
      {
        "id": "error-handling",
        "title": "审查错误处理策略",
        "kind": "action",
        "commands": [],
        "notes": "检查错误处理是否遵循统一的错误类型、错误边界是否合理、错误信息是否足够、是否存在空 catch 块（吞掉错误）。详见 `references/review-gate.md`。"
      },
      {
        "id": "logging",
        "title": "审查日志与可观测性",
        "kind": "action",
        "commands": [],
        "notes": "检查日志是否在合适的层级（entry/infra）、日志级别是否合适、是否包含足够上下文、是否泄露敏感信息。详见 `references/review-gate.md`。"
      },
      {
        "id": "documentation",
        "title": "审查注释与文档质量",
        "kind": "action",
        "commands": [],
        "notes": "检查复杂业务逻辑是否有注释说明"为什么"、public API 文档是否完整、是否存在需要删除的过时注释。详见 `references/review-gate.md`。"
      },
      {
        "id": "tests",
        "title": "审查测试策略与覆盖",
        "kind": "action",
        "commands": [],
        "notes": "检查关键业务逻辑是否有对应测试、测试是否覆盖边界情况和错误路径、测试是否依赖了不必要的外部资源。详见 `references/review-gate.md`。"
      },
      {
        "id": "performance-security",
        "title": "审查性能与安全考虑",
        "kind": "action",
        "commands": [],
        "notes": "检查是否存在明显的性能问题（循环中重复计算、资源泄漏、不必要的重渲染）和安全风险（XSS、注入、权限检查、数据验证）。详见 `references/review-gate.md`。"
      },
      {
        "id": "output",
        "title": "输出 Review 结果与改进建议",
        "kind": "action",
        "commands": [],
        "notes": "汇总 Review 结果，明确列出：符合规范的部分、需要改进的部分（按优先级）、可以转化为 Hard Gate 的重复问题。提供具体的改进建议和参考文档链接。"
      },
      {
        "id": "integrate",
        "title": "（可选）集成到 PR 模板",
        "kind": "action",
        "commands": [],
        "notes": "如果团队需要，可以将生成的 Review Checklist 集成到 `.github/pull_request_template.md` 或其他 PR 模板中，确保每次 PR 都经过规范检查。"
      }
    ]
  },
  "references": [
    "references/review-gate.md"
  ],
  "scripts": [],
  "assets": []
}
