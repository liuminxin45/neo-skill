{
  "version": 1,
  "name": "coding-standards",
  "description": "为 TypeScript/JavaScript（React/Vue/Node）项目建立可自动校验的 Hard Gate 编码规范：ESLint/TypeScript/Prettier + 边界约束（跨层/exports-only/禁止深层 import）+ 依赖检查（unused/ghost/版本漂移），并将架构/工程化规则尽可能落到可执行门禁（支持按仓库形态与主要改动层级自适应）。",
  "assistants": ["claude", "windsurf", "cursor", "github-skills"],
  "questions": [
    "你的仓库形态是什么（pnpm workspace / pnpm+nx / pnpm+turbo / 单包），以及现有命令习惯（lint/typecheck/test/depcheck）是什么？",
    "语言/框架范围是什么（TS/JS/React/Vue/Node），是否存在必须兼容的既有 ESLint/TS 配置？",
    "public entrypoints 的口径是否固定为 package.json#exports（是否允许例外/迁移期白名单）？",
    "边界检查工具倾向哪条路径（eslint-plugin-boundaries / dependency-cruiser），是否允许新增 devDependencies？",
    "分层模型是否采用 type-first（presentation/application/domain/infra/shared/types/tests），是否需要按仓库实际命名调整？",
    "复杂度门槛是否沿用默认：单函数 60 行、圈复杂度 15、鼓励早返回减少嵌套（保留必要 try-catch）？",
    "错误处理与日志：是否要求统一错误类型并限制 console.* 仅在边界层（entry/infra）？",
    "CI PR gate 需要覆盖哪些命令集合（最小门禁 vs 全量门禁），以及是否需要 affected/增量优化（nx/turbo）？"
  ],
  "triggers": [
    "我想给仓库增加 Hard Gate 编码规范（lint/typecheck/test/depcheck + 边界）",
    "帮我设置禁止跨层依赖、仅允许从 exports 导入、禁止深层 import",
    "帮我把架构/工程化规范变成可自动校验的门禁",
    "为 pnpm monorepo 配置 ESLint/TypeScript/Prettier + 边界检查",
    "为 PR/CI 增加强制的质量门禁",
    "整理代码"
  ],
  "freedom_level": "medium",
  "workflow": {
    "type": "sequential",
    "steps": [
      {
        "id": "branch",
        "title": "创建修复分支（commit id + 英文简述）",
        "kind": "gate",
        "commands": [
          "git status --porcelain",
          "git checkout -b \"$(git rev-parse --short HEAD)-<english-brief-kebab-case>\""
        ],
        "notes": "在开始修改前必须创建一个新分支，专用于修复当前（上次提交）引入的 coding-standards 问题。分支名规则：短 commit id + 英文简述（kebab-case）。如果工作区不干净，先提交/暂存/清理后再继续。"
      },
      {
        "id": "shape",
        "title": "识别仓库形态（repo shape）并选择最小改动路径",
        "kind": "action",
        "commands": [],
        "notes": "必须识别 pnpm-workspace / pnpm+nx / pnpm+turbo / pnpm-single，并给出证据；默认选择‘兼容现状 + 最小改动’路径。规则模板见 `.windsurf/workflows/data/coding-standards/repo-shapes/*.json`，详细规则见 `references/hard-gate.md`。"
      },
      {
        "id": "layer",
        "title": "基于 git diff 识别主要改动层级（type-first）",
        "kind": "action",
        "commands": [],
        "notes": "统计变更文件命中各 layer 的次数，输出 primary_layer 与 layers_changed；跨层变更时，额外强调边界与抽象复核。层级模型模板见 `.windsurf/workflows/data/coding-standards/layers/type-first.json`，详细规则见 `references/hard-gate.md`。"
      },
      {
        "id": "baseline",
        "title": "Hard Gate 基线：ESLint + TypeScript + Prettier（早期接入）",
        "kind": "gate",
        "commands": [],
        "notes": "目标：ESLint 覆盖 TS/JS 并按框架启用规则；TypeScript 使用 `tsc -b`；Prettier 只负责格式，避免与 ESLint 冲突。命令契约建议见 `references/pnpm-snippets.md`。"
      },
      {
        "id": "boundaries",
        "title": "边界约束（Hard Gate）：跨层/exports-only/禁止深层 import",
        "kind": "gate",
        "commands": [],
        "notes": "必须覆盖：禁止跨层依赖；只允许从 package.json#exports 导入；禁止深层内部目录 import。工具落地二选一：eslint-plugin-boundaries 或 dependency-cruiser（随 repo shape 推荐）。细节与默认 denylist 见 `references/hard-gate.md`。"
      },
      {
        "id": "portability",
        "title": "可移植性（Hard Gate）：绝对路径/cwd 依赖/alias 一致性/环境敏感值",
        "kind": "gate",
        "commands": [],
        "notes": "必须覆盖：绝对路径/用户目录、cwd 不确定性、alias 一致性、环境敏感值治理。细节见 `references/hard-gate.md` 的“可移植性（Hard Gate）”章节。"
      },
      {
        "id": "cycle-deps",
        "title": "循环依赖（Hard Gate）：模块循环 / 包循环 / 项目引用循环",
        "kind": "gate",
        "commands": [],
        "notes": "必须覆盖：模块循环/包循环/TS 引用循环的检测与阻断。细节见 `references/hard-gate.md` 的“循环依赖（Hard Gate）”章节。"
      },
      {
        "id": "security-hygiene",
        "title": "安全与仓库卫生（Hard Gate）：secrets / 危险 API / 产物入库 / lock 策略",
        "kind": "gate",
        "commands": [],
        "notes": "必须覆盖：secrets、危险 API、产物入库、lock 策略一致性。细节见 `references/hard-gate.md` 的“安全与仓库卫生（Hard Gate）”章节。"
      },
      {
        "id": "architecture",
        "title": "架构/工程化规范（尽可能自动化，剩余项进入 review gate）",
        "kind": "action",
        "commands": [],
        "notes": "默认按 type-first；层内职责边界采用‘目录即职责 + 依赖反推职责’；命名与一致性按约定；复杂度门槛：单函数 60 行、圈复杂度 15、鼓励早返回减少嵌套（保留必要 try-catch）；错误/日志/注释/文档按约定。详见 `references/hard-gate.md`。"
      },
      {
        "id": "deps",
        "title": "依赖检查（Hard Gate）：unused / ghost / 版本漂移",
        "kind": "gate",
        "commands": [],
        "notes": "必须覆盖：未使用依赖；幽灵依赖/越界依赖；版本漂移。推荐组合：depcheck/knip + import/no-extraneous-dependencies + syncpack。落地建议见 `references/pnpm-snippets.md`。"
      },
      {
        "id": "ci",
        "title": "CI PR gate 绑定 + 汇总输出（可执行清单）",
        "kind": "action",
        "commands": [],
        "notes": "触发：手动运行 + 绑定到 CI PR 检查。输出必须包含：repo_shape、primary_layer、边界工具选择；Hard Gate 自动化项/仅 review 项；最小 diff 的配置文件清单；本地与 CI 可复制命令清单。输出模板见 `references/hard-gate.md`。"
      },
      {
        "id": "pr",
        "title": "提交变更并创建 PR",
        "kind": "gate",
        "commands": [
          "git status --porcelain",
          "git add -A",
          "git commit -m \"chore(coding-standards): hard gate\"",
          "git push -u origin HEAD",
          "gh pr create --fill --title \"chore(coding-standards): hard gate\" || echo \"gh CLI not found; please create a PR manually from this branch.\""
        ],
        "notes": "将本次最小 diff 的配置变更提交到刚创建的分支，并创建 PR。优先使用 GitHub CLI（gh）。如果没有 gh，需要手动在 GitHub 上从当前分支发起 PR（base=main）。"
      }
    ]
  },
  "references": [
    "references/hard-gate.md",
    "references/pnpm-snippets.md"
  ],
  "scripts": [],
  "assets": [
    "assets/windsurf-workflow-data"
  ]
}
